# -----------------------------------------------------------------
# Global Settings
# -----------------------------------------------------------------
global:
  # The primary domain for your Netbird services.
  # This is used to configure all components.
  domain: "selfhosted.netbird.local"

# -----------------------------------------------------------------
# Secret Management
# -----------------------------------------------------------------
# The name of the *existing* Kubernetes Secret that contains all
# necessary keys (POSTGRES_USER, AUTH_CLIENT_ID, NB_AUTH_SECRET, etc.)
# You must create this secret manually *before* installing the chart.
existingSecretName: ""

secrets:
  # Database 
  # POSTGRES_DB: "netbirddb"
  # POSTGRES_USER: "netbird"
  # POSTGRES_PASSWORD: "SuperSecurePassword123!"

  # Dashboard
  AUTH_CLIENT_ID: ""
  AUTH_CLIENT_SECRET: ""
  AUTH_AUDIENCE: ""
  # NB_ACTIVITY_EVENT_STORE_ENGINE: "postgres"
  # NB_ACTIVITY_EVENT_POSTGRES_DSN: "postgresql://netbird:SuperSecurePassword123!@postgres:5432/netbirddb"

  # Relay
  NB_AUTH_SECRET: "4XF0OpISLgeb86c3LKApIEIrjSXttR6A4960Deij3O0"

  # Management (if using DB)
  # NETBIRD_STORE_ENGINE_POSTGRES_DSN: "postgresql://netbird:SuperSecurePassword123!@postgres:5432/netbirddb"
  NETBIRD_STORE_ENGINE_MYSQL_DSN: ""
# -----------------------------------------------------------------
# ConfigMaps
# -----------------------------------------------------------------
# Contents for the netbird-config and coturn-config ConfigMaps.
# You MUST provide the content for turnserver.conf and management.json here.
configmaps:
  create: true
  
  # Content for management.json
  # below is an invalid example; replace with your actual configuration
  managementJson: |
    {
      "turn": {
        "external": {
          "user": "netbird-user",
          "password": "netbird-password"
        }
      }
    }

  # Content for turnserver.conf
  # below is an invalid example; replace with your actual configuration
  turnserverConf: |
    # Example turnserver.conf content
    # Replace with your actual configuration
    lt-cred-mech
    user=netbird-user:netbird-password
    realm=netbird.selfhosted

  # Content for Let's Encrypt certificates
  letsencryptFullchain: |
    -----BEGIN CERTIFICATE-----
    MIIF...
    -----END CERTIFICATE-----
  
  letsencryptPrivkey: |
    -----BEGIN PRIVATE KEY-----
    MIIE...
    -----END PRIVATE KEY-----

# -----------------------------------------------------------------
# Persistence
# -----------------------------------------------------------------
# Global persistence settings. Can be overridden per-component.
persistence:
  # Your original file used ReadWriteOnce, common for single-node (k3s)
  # or block storage. Change to "ReadWriteMany" for multi-node with NFS/Ceph.
  accessModes: [ "ReadWriteOnce" ]
  storageClassName: "" # Set to your StorageClass, or "" for default

# -----------------------------------------------------------------
# PostgreSQL Database
# -----------------------------------------------------------------
# Deploys a self-contained PostgreSQL instance.
# Set 'enabled: false' if you use an external database.
postgres:
  enabled: true
  image:
    repository: "postgres"
    tag: "18" # Your original manifest used "18", which is not a valid tag. Using "16".
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP # Changed from LoadBalancer, as it's typically internal
    port: 5432 # TODO: make this port dynamic in postgres.yaml
  persistence:
    enabled: true
    size: 3Gi
    # accessModes: ... (uses global default)
    # storageClassName: ... (uses global default)

# -----------------------------------------------------------------
# Netbird Dashboard
# -----------------------------------------------------------------
dashboard:
  enabled: true
  replicas: 1
  image:
    repository: "netbirdio/dashboard"
    tag: "latest"
    pullPolicy: IfNotPresent
  
  # Dashboard environment configuration
  config:
    authAuthority: "https://accounts.google.com"
    useAuth0: "false"
    authSupportedScopes: "openid profile email"
    authRedirectUri: "/auth"
    authSilentRedirectUri: "/silent-auth"
    netbirdTokenSource: "idToken"
    nginxSslPort: "443"

  service:
    type: ClusterIP
    http:
      port: 80
      targetPort: 80
    https:
      port: 9443 # External port (e.g., for Ingress)
      targetPort: 443 # Container port

  # Persistence for Let's Encrypt certificates generated by the dashboard
  letsencryptPersistence: # TODO: this is not being used, instead configmap is being used
    enabled: true
    size: 1Gi
    # accessModes: ... (uses global default)
    # storageClassName: ... (uses global default)

# -----------------------------------------------------------------
# Netbird Signal
# -----------------------------------------------------------------
signal:
  enabled: true
  replicas: 1
  image:
    repository: "netbirdio/signal"
    tag: "latest"
    pullPolicy: IfNotPresent

  service:
    type: LoadBalancer
    port: 10000
    targetPort: 10000

  persistence:
    enabled: true
    size: 1Gi
    # accessModes: ... (uses global default)
    # storageClassName: ... (uses global default)

# -----------------------------------------------------------------
# Netbird Relay
# -----------------------------------------------------------------
relay:
  enabled: true
  replicas: 1
  image:
    repository: "netbirdio/relay"
    tag: "latest"
    pullPolicy: IfNotPresent

  config:
    logLevel: "info"
    listenAddress: ":33080"
    # Port must match listenAddress
    exposedPort: 33080 

  service:
    type: LoadBalancer
    port: 33080
    targetPort: 33080

# -----------------------------------------------------------------
# Netbird Management
# -----------------------------------------------------------------
management:
  enabled: true
  replicas: 1
  image:
    repository: "netbirdio/management"
    tag: "latest"
    pullPolicy: IfNotPresent

  config:
    # Command-line args for the management container
    port: "443"
    logFile: "console"
    logLevel: "info"
    disableAnonymousMetrics: "true"
    dnsDomain: "netbird.selfhosted"

  service:
    type: LoadBalancer
    port: 8443 # External port
    targetPort: 443 # Container port (matches --port arg)
  
  grpcService:
    type: LoadBalancer
    port: 33073
    targetPort: 33073
  
  persistence:
    enabled: true
    size: 1Gi
    # accessModes: ... (uses global default)
    # storageClassName: ... (uses global default)

# -----------------------------------------------------------------
# Coturn (TURN Server)
# -----------------------------------------------------------------
coturn:
  enabled: true
  replicas: 1
  image:
    repository: "coturn/coturn"
    tag: "latest"
    pullPolicy: IfNotPresent

  service:
    type: LoadBalancer
    port: 3478
    targetPort: 3478

# -----------------------------------------------------------------
# Adminer (Database GUI)
# -----------------------------------------------------------------
# Disabled by default, was commented out in your original file.
adminer:
  enabled: false
  replicas: 1
  image:
    repository: "adminer"
    tag: "latest"
    pullPolicy: IfNotPresent
  
  config:
    defaultServer: "{{ include \"netbird.fullname\" . }}-postgres" # Service name of the DB
    design: "lucas"

  service:
    type: LoadBalancer
    port: 8080
    targetPort: 8080


# -----------------------------------------------------------------
# Ingress
# -----------------------------------------------------------------
ingress:
  enabled: true

  # If you use an Ingress Controller that requires a specific class.
  # For NGINX: "nginx"
  # For Traefik: "traefik"
  className: ""

  # Annotations for your Ingress controller
  # (e.g., cert-manager, traefik, nginx)
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    # For NGINX:
    # nginx.ingress.kubernetes.io/backend-protocol: "HTTP"

  # Hostname for the Ingress.
  # Defaults to the 'global.domain' value if left empty.
  host: ""

  # TLS configuration
  tls:
    enabled: true
    # The name of the secret to store the certificate
    # This secret will be created by cert-manager
    secretName: "letsencrypt-certs"

  # Path for the Netbird Dashboard
  dashboard:
    path: /
    pathType: ImplementationSpecific # Or Prefix

  ## Feature not implemented in chart yet. Hence, commented out.
  # Path for the Netbird Management API (uncomment to enable)
  # This matches the commented-out path in your original file.
  # management:
  #   path: /api
  #   pathType: Prefix